# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара. 

```
export interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Заказ.

```
export interface IOrder {
	payment: string;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[] ;
}
```

Интерфейс для модели данных карточек

```
export interface IProductList {
	total: number;
	items: IProduct[];
	preview: string | null;
}
```


Карточеки в корзине.
```
export type TBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>;
```
Данные в форме оплата.
```
export type TOrderPayment  = Pick<IOrder, 'payment' | 'address'>
```
Данные в форме котакты.
```
export type TOrderContacts  = Pick<IOrder, 'email' | 'phone'>
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными карточек товара.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `_items: ICard[]` - массив объектов карточек товара.
- `_preview: string | null` - id карточка товара, выбранной для просмотра в модальной окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `setProductList(productData: IProduct): IProductList`  - устанавливает объект с карточками и ихколичеством.  
- `getProducts(): IProductList` - получает объект с карточками и ихколичеством.
- `getProduct(productList: IProductList): IProduct[]` - возвращает список карточек товара.
- `getCard(cardId: string): ICard` - возвращает карточку по ее id

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными заказа.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `_basket: TBasketItem[]` - товары в корзине
- `_order: IOrder` - данные заказа
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `addProduct(product: TBasketItem): void` - добавляет товар в корзину и заказ.
- `deleteProduct(idProduct: string): void` - удаляет товар из корзины и заказа.
- `checkValidation(data: Record<keyof TOrderPayment, string>| Record<keyof TOrderContacts, string>):boolean` - проверяет объект с данными заказа на валидность.

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.  
- `constructor(container: HTMLElement, events: IEvents)` Конструктор принимает `container`, в котором будет разметка содержимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- `modal: HTMLElement` - элемент модального окна
- `events: IEvents` - брокер событий

#### Класс ModalProduct
Расширяет класс Modal. Предназначен для реализации модального окна товара. При открытии модального окна отображает подробную информацию о товаре и кнопку добавления в корзину или удаления из нее.\
Поля класса:
- `_category: HTMLSpanElement` - элемент карточки категория
- `_title: HTMLHeadingElement` - элемент карточки заголовок
- `_image: HTMLImageElement` - элемент карточки заголовок изображение
- `toggleButton: HTMLButtonElement`- кнопка добавления или удаления из корзины

Методы:
- `setValue(isValid: boolean): void` - изменение активности кнопки(если у товара нет цены, то его нельзя добавить в корзину).
- `isInBasket(id: string): boolean` - изменение функционала кнопки. Если данный товар в корзине, то кнопка будет "Удалить", если товара нет в корзине, то кнопка будет "Добавить".

#### Класс ModalBasket
Расширяет класс Modal. Предназначен для реализации модального окна корзина. Отображает список товаров с название и ценой, а так же общей суммой Предоставляет методы для управления активностью кнопки оформления.\
Поля класса:
- `_itemList: HTMLUListElement` - список товаров 
- `orderButton: HTMLButtonElement` - кнопка формления заказа
- `_totalPrice: HTMLSpanElement` - общая цена товаров в корзине

Методы:
- `setValid(isValid: boolean): void` - изменяет активность кнопки формления

#### Класс ItemBasket
Предназначен для реализации элемента списка в корзине. Отображает данные товара в корзине. Предоставляет методы для управления активностью кнопки оформления.\
Поля класса:
- `_itemList: HTMLUListElement` - список товаров 
- `orderButton: HTMLButtonElement` - кнопка формления заказа
- `_totalPrice: HTMLSpanElement` - общая цена товаров в корзине

Методы:
- `setValid(isValid: boolean): void` - изменяет активность кнопки формления

#### Класс ModalFormPayment
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей поле ввода и кнопки выбора способа оплаты. При сабмите инициирует событие передавая в объект заказа данные из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки далее.\
Поля класса:
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- cardButton: HTMLButtonElement - кнопка онлайн оплаты
- cashButton: HTMLButtonElement - кнопка оплаты при получении
- input: HTMLInputElement - поле ввода формы для заполнения адреса
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки далее
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы